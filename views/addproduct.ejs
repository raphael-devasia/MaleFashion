<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
<meta name="description" content="POS - Bootstrap Admin Template">
<meta name="keywords" content="admin, estimates, bootstrap, business, corporate, creative, invoice, html5, responsive, Projects">
<meta name="author" content="Dreamguys - Bootstrap Admin Template">
<meta name="robots" content="noindex, nofollow">
<title>Dreams Pos admin template</title>

<link rel="shortcut icon" type="image/x-icon" href="../assets/img/favicon.jpg">

<link rel="stylesheet" href="../assets/css/bootstrap.min.css">
<link rel="stylesheet" href="../assets/css/animate.css">
<link rel="stylesheet" href="../assets/plugins/select2/css/select2.min.css">
<link rel="stylesheet" href="../assets/css/dataTables.bootstrap4.min.css">
<link rel="stylesheet" href="../assets/plugins/fontawesome/css/fontawesome.min.css">
<link rel="stylesheet" href="../assets/plugins/fontawesome/css/all.min.css">
<link rel="stylesheet" href="../assets/css/style.css">
</head>
<body>
<div id="global-loader">
<div class="whirly-loader"> </div>
</div>

<div class="main-wrapper">
<%- include('dashheader') %>

<div class="sidebar" id="sidebar">
<div class="sidebar-inner slimscroll">
<div id="sidebar-menu" class="sidebar-menu">
<ul>
<li>
<a href="home"><img src="../assets/img/icons/dashboard.svg" alt="img"><span> Dashboard</span> </a>
</li>
<li class="submenu">
<a href="javascript:void(0);"><img src="../assets/img/icons/product.svg" alt="img"><span> Product</span> <span class="menu-arrow"></span></a>
<ul>
<li><a href="products">Product List</a></li>
<li><a href="addproduct" class="active">Add Product</a></li>
<li><a href="categories">Category List</a></li>
<li><a href="addcategory">Add Category</a></li>
<li><a href="brands">Brand List</a></li>
<li><a href="addbrand">Add Brand</a></li>
</ul>
</li>
<li class="submenu">
<a href="javascript:void(0);"><img src="../assets/img/icons/users1.svg" alt="img"><span> Users</span> <span class="menu-arrow"></span></a>
<ul>
<li><a href="newuser">New User </a></li>
<li><a href="users">Users List</a></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<form action="/admin/addproduct" method="post" enctype="multipart/form-data">
<div class="page-wrapper">
<div class="content">
<div class="page-header">
<div class="page-title">
<h4>Product Add</h4>
<h6>Create new product</h6>
</div>
</div>
<div class="card">
<div class="card-body">
<div class="row">
<div class="col-lg-3 col-sm-6 col-12">
                                <div class="form-group">
                                    <label>Product Name</label>
                                    <select class="select" id="existingProducts" onchange="populateDescription()">
                                        <option value="">Select Existing Product</option>
                                        <% product.forEach((row) => { %>   
                                            <option value="<%= row._id %>"><%= row._id %> - <%= row._id %></option>
                                        <% }); %>
                                    </select>
                                    <input type="text" id="newProductName" placeholder="Or type new product name" name="product_name" oninput="clearDropdown()">
                                    <input type="hidden" id="productId" name="product_id">
                                </div>
                            </div>
<div class="col-lg-3 col-sm-6 col-12">
<div class="form-group">
<label>Category</label>
<select class="select" name="category_name">
  <% categories.forEach((row,index) => { %>   
    <option value="<%= row.category_name %>"><%= row.category_name %></option>
  <% }); %>
</select>
</div>
</div>
<div class="col-lg-3 col-sm-6 col-12">
<div class="form-group">
<label>Size</label>
<select class="select" name="size">
<option>Choose Size</option>
<% sizeOptions.forEach((row,index) => { %>   
    <option value="<%= row.Size_name %>"><%= row.Size_name %></option>
  <% }); %>
</select>
</div>
</div>
<div class="col-lg-3 col-sm-6 col-12">
<div class="form-group">
<label>Colour</label>
<select class="select" name="Colour_name">
<option>Choose Colour</option>
<% colourOptions.forEach((row,index) => { %>   
    <option value="<%= row.Colour_name %>"><%= row.Colour_name %></option>
  <% }); %>
</select>
</div>
</div>
<div class="col-lg-3 col-sm-6 col-12">
<div class="form-group">
<label>SKU</label>
<input type="text" name="SKU">
</div>
</div>
<div class="col-lg-3 col-sm-6 col-12">
<div class="form-group">
<label>Quantity</label>
<input type="text" name="Qty_in_stock">
</div>
</div>
<div class="col-lg-12">
<div class="form-group">
<label>Description</label>
<textarea class="form-control" name="product_description" id="productDescription"></textarea>
</div>
</div>
<div class="col-lg-3 col-sm-6 col-12">
<div class="form-group">
<label>Price</label>
<input type="text" name="price">
</div>
</div>
<div class="col-lg-12">
  <div class="form-group">
    <label> Product Images</label>
    <div class="image-upload">
      <input type="file" id="product_image_input" onchange="displayThumbnails(event)" name="product_images" multiple>
      <div class="image-uploads">
        <img id="thumbnail" src="../assets/img/icons/upload.svg" alt="img">
        <h4>Drag and drop files to upload</h4>
      </div>
    </div>
  </div>
</div>
<div class="col-12" id="productListSection" style="display: none;">
  <div class="product-list">
    <ul class="row" id="imageList">
      <!-- Images will be appended here -->
    </ul>
  </div>
</div>
<div class="col-lg-12">
<button type="submit" class="btn btn-submit me-2">Submit</button>
<a href="products" class="btn btn-cancel">Cancel</a>
</div>
</div>
</div>
</div>
</div>
</div>

</form>
<div><% if (locals.msg &&locals.msg.length > 0) { %>
            <div class="alert alert-info">
                <%locals.msg.forEach(function(message) { %>
                    <p><%= message %></p>
                <% }) %>
            </div>
        <% } %>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const products = <%- JSON.stringify(product) %>;

    window.populateDescription = function() {
        const select = document.getElementById('existingProducts');
        const selectedProductId = select.value;
        const productDescriptionField = document.getElementById('productDescription');
        const newProductNameField = document.getElementById('newProductName');
        const productIdField = document.getElementById('productId');

        if (selectedProductId) {
            const selectedProduct = products.find(p => p._id === selectedProductId);
            if (selectedProduct) {
                productDescriptionField.value = selectedProduct.Product_description || '';
                productDescriptionField.readOnly = true;
                newProductNameField.value = selectedProduct._id;
                newProductNameField.readOnly = true;
                productIdField.value = selectedProduct.Product_variation_ids; // Adjusted to use the first product variation ID
            }
        } else {
            productDescriptionField.value = '';
            productDescriptionField.readOnly = false;
            newProductNameField.value = '';
            newProductNameField.readOnly = false;
            productIdField.value = '';
        }
    }

    window.clearDropdown = function() {
        const existingProductsDropdown = document.getElementById('existingProducts');
        existingProductsDropdown.value = '';
        document.getElementById('productDescription').readOnly = false;
        document.getElementById('productDescription').value = '';
        document.getElementById('productId').value = '';
        document.getElementById('newProductName').readOnly = false;
    }
});

</script>

<script src="../assets/js/jquery-3.6.0.min.js"></script>
<script src="../assets/js/feather.min.js"></script>
<script src="../assets/js/jquery.slimscroll.min.js"></script>
<script src="../assets/js/jquery.dataTables.min.js"></script>
<script src="../assets/js/dataTables.bootstrap4.min.js"></script>
<script src="../assets/js/bootstrap.bundle.min.js"></script>
<script src="../assets/plugins/select2/js/select2.min.js"></script>
<script src="../assets/plugins/sweetalert/sweetalert2.all.min.js"></script>
<script src="../assets/plugins/sweetalert/sweetalerts.min.js"></script>
<script src="../assets/js/script.js"></script>

<script>
$(document).ready(function() {
  $.ajax({
    url: '/products',
    method: 'GET',
    success: function(data) {
      data.forEach(product => {
        $('#existingProducts').append(new Option(product.Product_variation_id.Product_item_id.Product_id.product_name, product._id));
      });
    }
  });
});
</script>

<script>
$(document).ready(function() {
  const productImageContainer = $('#imageList');
  
  function displayThumbnails(event) {
    const files = event.target.files;
    Array.from(files).forEach(file => {
      const reader = new FileReader();
      reader.onload = (event) => {
        const imageDataUrl = event.target.result;
        const img = $('<img>').attr('src', imageDataUrl).addClass('uploaded-image');
        const li = $('<li>').addClass('ps-0').append(
          $('<div>').addClass('productviewset').append(
            $('<div>').addClass('productviewsimg').append(img),
            $('<div>').addClass('productviewscontent').append(
              $('<a>').attr('href', 'javascript:void(0);').addClass('hideset').html('<i class="fa fa-trash-alt"></i>').on('click', function() {
                $(this).closest('li').remove();
              })
            )
          )
        );
        productImageContainer.append(li);
      };
      reader.readAsDataURL(file);
    });
    if (files.length > 0) {
      $('#productListSection').show();
    }
  }
  
  $('#product_image_input').on('change', function(event) {
    displayThumbnails(event);
  });

  $('#thumbnail').hide();
  $('#product_image_input').on('click', function() {
    if (!this.value) {
      $('#thumbnail').show();
    }
  });
});
</script>
</body>
</html>
