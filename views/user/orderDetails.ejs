<%- include('navigationbar') %>
  <!-- Header Section End -->
<link rel="stylesheet" href="/css/adress-book.css" type="text/css" />
  <!-- Breadcrumb Section Begin -->
  <section class="breadcrumb-option">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <div class="breadcrumb__text">
            <h4>Shop</h4>
            <div class="breadcrumb__links">
              <a href="./index.html">Home</a>
              <span>User</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- Breadcrumb Section End -->
  <main class="main">
    <section class="section-parent">
      <div class="profile-details">
        <div class="profile-inner">

          <div class="account-management">
            <div class="container mb-4 main-container">
              <div class="row">
                <div class="col-lg-4 pb-5">
                  <!-- Account Sidebar-->
                <%- include('profilesidebar') %>
                </div>
                <!-- Orders Table-->
                <!-- Orders Table-->
                <!-- Title -->
                <!-- Title -->


                <!-- Main content -->
                <div class="col-lg-8 pb-5">

                  <div class="row">
                    <div class="col-md-12">
                      <!-- Details -->
                      <div class="card mb-4">
                        <div class="card-body">
                        <div class="row">
                          <% function getOverallStatus(statusArray) { if (statusArray.every(status=> status === 'Cancelled')) {
                            return 'Cancelled';
                            } else if (statusArray.every(status => status ===
                            'Shipped')) {
                            return 'Shipped';
                            } else if (statusArray.every(status => status ===
                            'Delivered')) {
                            return 'Delivered';
                            } else if (statusArray.every(status => status ===
                            'Pending')) {
                            return 'Pending';
                            } else if (statusArray.every(status => status ===
                            'Returned')) {
                            return 'Returned';
                            } else {
                            return 'Processing'; // Default status
                            }
                            } %>

                           
                            <div class="col text-end d-flex justify-content-end">
                                <% if (getOverallStatus(orderDetails.Status)==="Pending" ) { %>
                                  <button class="btn btn-link p-0 me-3 d-none d-lg-block btn-icon-text" data-toggle="modal" data-target="#invoiceModal" disabled>
                                    <i class="bi bi-download"></i>
                                
                                    <span class="text">Invoice</span>
                                  </button>
                                  <% } else { %>
                                    <button class="btn btn-link p-0 me-3 d-none d-lg-block btn-icon-text" data-toggle="modal"
                                      data-target="#invoiceModal">
                                      <i class="bi bi-download"></i>
                                
                                      <span class="text">Invoice</span>
                                    </button>
                                
                                    <% } %>
                            </div>
                        </div>

                            
                          <div class="mb-3 justify-content-between">
                            
                            <div>
                            <span class="me-3">Order Placed On: <%= (orderDetails.Order_id.Order_status.createdAt ).toLocaleDateString() %></span>
                           
                              <!-- <span class="me-3">#16123222</span>
                                                      <span class="me-3"></span> -->

                                                    
                             

                              <div class="d-flex  align-items-center py-3">
                                <h2 class="h5 mb-0"><a href="#" class="text-muted"></a> Order # <%=
                                                                            orderDetails.Order_id.Order_number %>
                                </h2>
                                <% if (getOverallStatus(orderDetails.Status) ==="Pending") { %>
                                  <span class="badge rounded-pill bg-danger">
                                    <%= getOverallStatus(orderDetails.Status) %>
                                  </span>
                                <% } else {%>
                                <span class="badge rounded-pill bg-info">
                                  <%= getOverallStatus(orderDetails.Status) %>
                                </span>
                                <% } %>
                              </div>
</div>
                            </div>
                            <div class="d-flex ">
                              
                              <!-- INVOICE MODAL -->
                             

                              <div class="modal fade" id="invoiceModal" tabindex="-1" aria-labelledby="invoiceModalLabel" aria-hidden="true">
                                
                               
                                <div class="modal-dialog modal-xl">
                                  <div class="modal-content">
                                    <div class="modal-header">
                                      
                                      <h5 class="modal-title" id="invoiceModalLabel">Invoice</h5>
                                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                      </button>
                                    </div>
                                    <div class="modal-body">
                                      <div class="page-content container" id="invoiceContent">
                                        <div class="page-header text-blue-d2">
                                          <h1 class="page-title text-secondary-d1">
                                            Invoice
                                            <small class="page-info">
                                              <i class="fa fa-angle-double-right text-80"></i>
                                              ID: #<%= orderDetails.Order_id.Order_number %>
                                            </small>
                                          </h1>

                                          <div class="page-tools">
                                            <div class="action-buttons">
                                              <a class="btn bg-white btn-light mx-1px text-95" href="#" data-title="Print">
                                                <i class="mr-1 fa fa-print text-primary-m1 text-120 w-2"></i>
                                                Print
                                              </a>
                                              <a class="btn bg-white btn-light mx-1px text-95" href="#" data-title="PDF" id="downloadPdf">
                                                <i class="mr-1 fa fa-file-pdf-o text-danger-m1 text-120 w-2"></i>
                                                Export
                                              </a>
                                            </div>
                                          </div>
                                        </div>

                                        <div class="container px-0">
                                          <div class="row mt-4">
                                            <div class="col-12 col-lg-12">
                                              <div class="row">
                                                <div class="col-12">
                                                  <div class="text-center text-150">
                                                    <img src="/img/logo.png" alt="Company Logo" style="max-width: 150px;">
                                                    <!-- Added Logo Image -->
                                                    <!-- Optional Company Name -->
                                                  </div>
                                                </div>
                                              </div>
                                              <!-- .row -->

                                              <hr class="row brc-default-l1 mx-n1 mb-4" />

                                              <div class="row">
                                                <div class="col-sm-6">
                                                  <div>
                                                    <span class="text-sm text-grey-m2 align-middle">To:</span>
                                                    <span class="text-600 text-110 text-blue align-middle">
                                                      <%= orderDetails.Order_id.Billing_address.FirstName
                                                                                                                    %>
                                                      <%= orderDetails.Order_id.Billing_address.LastName
                                                                                                                        %>
                                                    </span>
                                                  </div>
                                                  <div class="text-grey-m2">
                                                    <div class="my-1">

                                                    </div>
                                                    <div class="my-1">
                                                      <%= orderDetails.Order_id.Billing_address.House_number
                                                                                                                    %> ,
                                                    <%= orderDetails.Order_id.Billing_address.Address_line_1%>
                                                    </div>
                                                    <div class="my-1">
                                                      <i class="fa fa-phone fa-flip-horizontal text-secondary"></i>
                                                      <b class="text-600"></b>
                                                    </div>
                                                  </div>
                                                </div>
                                                <!-- /.col -->

                                                <div class="text-95 col-sm-6 align-self-start d-sm-flex justify-content-end">
                                                  <hr class="d-sm-none" />
                                                  <div class="text-grey-m2">
                                                    <div class="mt-1 mb-2 text-secondary-m1 text-600 text-125">
                                                      Invoice
                                                    </div>

                                                    <div class="my-2">
                                                      <i class="fa fa-circle text-blue-m2 text-xs mr-1"></i>
                                                      <span class="text-600 text-90">ID:</span>
                                                      #<%= orderDetails.Order_id.Order_number
                                                                                                                    %>
                                                    </div>

                                                    <div class="my-2">
                                                      <i class="fa fa-circle text-blue-m2 text-xs mr-1"></i>
                                                      <span class="text-600 text-90">Issue
                                                        Date:</span>
                                                      Oct 12,
                                                      2019
                                                    </div>

                                                    <div class="my-2">
                                                      <i class="fa fa-circle text-blue-m2 text-xs mr-1"></i>
                                                      <span class="text-600 text-90">Status:</span>
                                                      <span class="badge badge-warning badge-pill px-25"><div>
                                                        <% function determinePaymentStatus(order) { const statuses=order.Status; const
                                                            paymentMethod=order.Order_id.Payment_method_id.Value; if (statuses.includes('Returned')) { return 'REFUNDED' ; }
                                                            else if (paymentMethod==='Cash On Delivery' ) { if (statuses.includes('Delivered')) { return 'PAID' ; } else {
                                                            return 'PENDING' ; } } else { return 'PAID' ; } } const paymentStatus=determinePaymentStatus(orderDetails); %>
                                                    </div>
                                                        <%= paymentStatus
                                                                                                                        %>
                                                      </span>
                                                    </div>
                                                  </div>
                                                </div>
                                                <!-- /.col -->
                                              </div>


                                              <div class="mt-4">
                                                <div class="row text-600 text-white bgc-default-tp1 py-25">

                                                  <div class="col-9 col-sm-5">
                                                    Description
                                                  </div>
                                                  <div class="d-none d-sm-block col-4 col-sm-2">
                                                    Qty</div>
                                                  <div class="d-none d-sm-block col-sm-2">
                                                    Unit Price
                                                  </div>
                                                  <div class="col-2">
                                                    Amount</div>
                                                </div>

                                                <div class="text-95 text-secondary-d3">
                                                <% for(let i=0; i < orderDetails.Product_item_id.length; i++ ) { %>
                                                  <div class="row mb-2 mb-sm-0 py-25">
                                                    
                                                    <div class="col-9 col-sm-5">
                                                    <%= productArray[i].Product_item.Product_variation_id.Product_item_id.Product_id.product_name %>
                                                        </div>
                                                        <div class="d-none d-sm-block col-2">
                                                            <%= orderDetails.Qty[i] %>
                                                        </div>
                                                        <div class="d-none d-sm-block col-2 text-95">
                                                            $
                                                            <%= productArray[i].Product_item.Product_variation_id.Product_item_id.Original_price %>
                                                        </div>
                                                        <div class="col-2 text-secondary-d2">
                                                            $
                                                            <%= (productArray[i].Product_item.Product_variation_id.Product_item_id.Original_price)*orderDetails.Qty[i] %>
                                                        </div>
                                                        </div>
                                                        
                                                        <% } %>
                                                        
                                                        
                                                        
                                                            <div class="row border-b-2 brc-default-l2">
                                                            </div>
                                                        
                                                            <div class="row mt-3 d-flex justify-content-end ">
                                                      
                                                        
                                                                <div class="col-12  col-sm-5 text-grey text-90 order-first order-sm-last me-5 pe-5">
                                                                    <div class="row my-2">
                                                                        <div class="col-7 text-right">
                                                                            SubTotal
                                                                        </div>
                                                                        <div class="col-5">
                                                                            <span class="text-120 text-secondary-d1">$
                                                                                <%= (orderDetails.Order_id.Product_cost).toFixed(2)%>
                                                                            </span>
                                                                        </div>
                                                                    </div>
                                                        
                                                                    <div class="row my-2">
                                                                        <div class="col-7 text-right">
                                                                            Coupon
                                                                            discount
                                                                        </div>
                                                                        <div class="col-5">
                                                                            <span class="text-110 text-secondary-d1">$
                                                                                <%= (orderDetails.Order_id.Coupon_discount).toFixed(2) %>
                                                                            </span>
                                                                        </div>
                                                                    </div>
                                                                    <div class="row my-2">
                                                                        <div class="col-7 text-right">
                                                                            Store
                                                                            discount
                                                                        </div>
                                                                        <div class="col-5">
                                                                            <span class="text-110 text-secondary-d1">$
                                                                                <%= (orderDetails.Order_id.Sales_discount).toFixed(2) %>
                                                                            </span>
                                                                        </div>
                                                                    </div>
                                                        
                                                                    <div class="row my-2 align-items-center bgc-primary-l3 p-2">
                                                                        <div class="col-7 text-right">
                                                                            Total
                                                                            Amount
                                                                        </div>
                                                                        <div class="col-5">
                                                                            <span class="text-150 text-success-d3 opacity-2">$
                                                                                <%= (orderDetails.Order_id.Order_total).toFixed(2) %>
                                                                            </span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        
                                                            <hr />
                                                        
                                                            <div>
                                                                <span class="text-secondary-d1 text-105">Thank
                                                                    you
                                                                    for
                                                                    your
                                                                    business</span>
                                                        
                                                            </div>
                                                            </div>
                                                            </div>
                                                            </div>
                                                            </div>
                                                            </div>
                                                            </div>
                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                                            </div>
                                                            </div>
                                                            </div>
                                                            </div>

                                <!-- INVOICE MODAL END -->
                                <div class="dropdown">
                                  <button class="btn btn-link p-0 text-muted" type="button" data-bs-toggle="dropdown">
                                    <i class="bi bi-three-dots-vertical"></i>
                                  </button>
                                  <ul class="dropdown-menu dropdown-menu-end">
                                    <li><a class="dropdown-item" href="#"><i class="bi bi-pencil"></i>
                                        Edit</a></li>
                                    <li><a class="dropdown-item" href="#"><i class="bi bi-printer"></i>
                                        Print</a>
                                    </li>
                                  </ul>
                                </div>
                              </div>
                            </div>

                            <table class="table table-borderless">
                              <tbody>
                                <% for (let i=0; i <
                                                                    orderDetails.Product_item_id.length; i++) { %>
                                <tr class="<%= orderDetails.Status[i] === 'Cancelled' ? 'text-muted' : '' %>">
                                  <td>
                                    <div class="d-flex mb-2">
                                      <div class="flex-shrink-0">
                                        <img src="<%= productArray[i].Product_item.Image_filename[0] %>" alt="" width="35" class="img-fluid">
                                      </div>
                                      <div class="flex-lg-grow-1 ms-3">
                                        <h6 class="small mb-0">
                                          <a href="#" class="text-reset">
                                            <%= productArray[i].Product_item.Product_variation_id.Product_item_id.Product_id.product_name
                                                                                                %>
                                          </a>
                                        </h6>
                                        <span class="small">Color: <%=
                                                                                            productArray[i].Product_item.Product_variation_id.Product_item_id.Colour_id.Colour_name
                                                                                            %></span>
                                      </div>
                                    </div>
                                  </td>
                                  <td>
                                    <%= orderDetails.Qty[i] %>
                                  </td>
                                  <td class="text-end">$ <%=
                                                                                productArray[i].Product_item.Product_variation_id.Product_item_id.Original_price
                                                                                %>
                                  </td>
                                  <td>

                                    <% if (orderDetails.Status[i]==='Cancelled'
                                                                                ) { %>
                                    <!-- Muted and disabled button for Cancelled status -->
                                    <button type="button" class="btn btn-secondary" disabled>Cancelled</button>
                                    <% } else if
                                                                                    (orderDetails.Status[i]==='Processing'
                                                                                    ) { %>
                                    <button type="button" class="btn btn-danger" data-id="<%= orderDetails.Product_item_id[i] %>" data-order-id="<%= orderDetails._id %>" data-toggle="modal" data-target="#exampleModalCenterItem">
                                      Cancel
                                    </button>
                                    <% } else if
                                                                                        (orderDetails.Status[i]==='Delivered'
                                                                                        ) { %>
                                    <a href="/user/orders/return-delivery/<%= orderDetails.Product_item_id[i] %>?orderId=<%= orderDetails._id %>" type="button" class="btn btn-danger">
                                      Return Item
                                    </a>
                                    <% } else if
                                                                                            (orderDetails.Status[i]==='Returned'
                                                                                            ) { %>
                                    <button type="button" class="btn btn-secondary" disabled>Returned</button>
                                    <% } else if
                                                                                                (orderDetails.Status[i]==='Refunded'
                                                                                                ) { %>
                                    <button type="button" class="btn btn-secondary" disabled>Refunded</button>
                                    <% } else if
                                                                                                    (orderDetails.Status[i]==='Shipped'
                                                                                                    ) { %>
                                    <button type="button" class="btn btn-success" disabled>Shipped</button>
                                    <a href="/user/orders/confirm-delivery/<%= orderDetails.Product_item_id[i] %>?orderId=<%= orderDetails._id %>" type="button" class="btn btn-info">
                                      Confirm delivery
                                    </a>
                                    <% } %>
                                  </td>
                                </tr>
                                <% } %>
                              </tbody>

                              <tfoot>
                                <tr>
                                  <td colspan="2">Subtotal</td>
                                  <td class="text-end">$ <%=
                                                                            (orderDetails.Order_id.Product_cost).toFixed(2)%>
                                  </td>
                                </tr>
                                <tr>
                                  <td colspan="2">Shipping</td>
                                  <td class="text-end">$00.00</td>
                                </tr>
                                <tr>
                                  <td colspan="2">Discount (Code:<%=
                                                                            orderDetails.Order_id.Coupon_code%>)</td>
                                  <td class="text-danger text-end">-$<%=
                                                                            (orderDetails.Order_id.Coupon_discount/100).toFixed(2)
                                                                            %>
                                  </td>
                                </tr>
                                <tr>
                                  <td colspan="2">Sales Discount</td>
                                  <td class="text-danger text-end">-$ <%=
                                                                            (orderDetails.Order_id.Sales_discount).toFixed(2)
                                                                            %>
                                  </td>
                                </tr>
                                <tr class="fw-bold">
                                  <td colspan="2">TOTAL</td>
                                  <td class="text-end">$<%=
                                                                            (orderDetails.Order_id.Order_total).toFixed(2)
                                                                            %>
                                  </td>
                                </tr>
                              </tfoot>
                            </table>
                          </div>
                        </div>
                     
                        <div class="card mb-4 ">
                          <div class="card-body">
                            <div class="row">
                              <div class="col-lg-6">
                                
                                

<% if (getOverallStatus(orderDetails.Status)==="Pending" ) { %>

<h3 class="h6">Payment Failed</h3>
<form id="payment-form" method="POST" action="/payment-retry">
  <p>
    <br>
    Total: $ <%= (orderDetails.Order_id.Order_total).toFixed(2) %>
      <input type="hidden" name="total" value="<%= orderDetails.Order_id.Order_total %>">
      <input type="hidden" name="orderId" value="<%= orderDetails.Order_id._id %>">
      <button type="submit" class="btn btn-info btn-lg openmodal" id="rzp-button1">Pay Now</button>
  </p>
</form>
  
  <% } else { %>
      <h3 class="h6">Payment Method</h3>
      <p>
        <%= orderDetails.Order_id.Payment_method_id.Value %>
          <br>
          Total: $ <%= (orderDetails.Order_id.Order_total).toFixed(2) %>
            <span
              class="badge bg-<%= paymentStatus === 'PENDING' ? 'success' : paymentStatus === 'PAID' ? 'primary' : 'danger' %> rounded-pill">
              <%= paymentStatus %>
            </span>
      </p>

    <% } %>

<!--Division for Modal-->
<div id="myModal" class="modal fade" role="dialog">

  <!--Modal-->
  <div class="modal-dialog">

    <!--Modal Content-->
    <div class="modal-content">

    
      <!-- Modal Body-->
      <div class="modal-body text-center">
        <i class="far fa-file-alt fa-4x mb-3 animated rotateIn icon1"></i>
        <h3>Payment Methods</h3>
       
      </div>

      <!-- Radio Buttons for Rating-->
      <div class="form-check mb-4">
        <input name="feedback" type="radio">
        <label class="ml-3">Credit Card</label>
      </div>
      <div class="form-check mb-4">
        <input name="feedback" type="radio">
        <label class="ml-3">Cash On Delivery</label>
      </div>
      <div class="form-check mb-4">
        <input name="feedback" type="radio">
        <label class="ml-3">Bank Transfer</label>
      </div>
      

     
      <!-- Modal Footer-->
      <div class="modal-footer">
        <a href="" class="btn btn-primary">PROCEED
          
        </a>
        <a href="" class="btn btn-outline-primary" data-dismiss="modal">CANCEL</a>
      </div>

    </div>

  </div>

</div>
                             




                               



                              </div>
                            </div>
                          </div>
                        </div>
                        <!-- Modal -->
                        <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                          <div class="modal-dialog modal-dialog-centered" role="document">
                            <div class="modal-content">
                              <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLongTitle">Order
                                  Cancellation</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                  <span aria-hidden="true">&times;</span>
                                </button>
                              </div>
                              <div class="modal-body">
                                Do you Want to cancel this order?
                              </div>
                              <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>

                                <a href="/user/orders/delete/<%= orderDetails._id %>" type="button" class="btn btn-primary">Confirm</a>


                              </div>
                            </div>
                          </div>
                        </div>
                        <!-- 2 -->
                        <div class="modal fade" id="exampleModalCenterItem" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                          <div class="modal-dialog modal-dialog-centered" role="document">
                            <div class="modal-content">
                              <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLongTitle">Item
                                  Cancellation</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                  <span aria-hidden="true">&times;</span>
                                </button>
                              </div>
                              <div class="modal-body">
                                Do you want to cancel this item?
                              </div>
                              <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                <a href="#" id="confirmCancelBtn" class="btn btn-primary">Confirm</a>
                              </div>
                            </div>
                          </div>
                        </div>


                      </div>
                    </div>
                  </div>



                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-4">

            <div class="card mb-4">

            </div>
            <div class="card mb-4">

              <div class="card-body">
                <h3 class="h6"></h3>
                <strong>Billing Information</strong>

                <hr>

                <address>
                  <p>
                    <%= orderDetails.Order_id.Billing_address.FirstName %>
                    <%= orderDetails.Order_id.Billing_address.LastName %>
                  </p>

                  <p>
                    <%= orderDetails.Order_id.Billing_address.House_number %> ,<%=
                                                orderDetails.Order_id.Billing_address.Address_line_1%>
                  </p>

                  <p>
                    <%= orderDetails.Order_id.Billing_address.Address_line_2 %>,<%=
                                                orderDetails.Order_id.Billing_address.Postal_code %>
                  </p>

                  <p>
                    <%= orderDetails.Order_id.Billing_address.State %>,<%=
                                                orderDetails.Order_id.Billing_address.Country %>
                  </p>
                  <p></p>
                </address>
              </div>
            </div>
            <div class="card mb-4">

              <div class="card-body">
                <h3 class="h6"></h3>
                <strong>Shipping Information</strong>

                <hr>

                <address>
                  <p>
                    <%= orderDetails.Order_id.Shipping_address.FirstName %>
                    <%= orderDetails.Order_id.Shipping_address.LastName %>
                  </p>

                  <p>
                    <%= orderDetails.Order_id.Shipping_address.House_number %> ,<%=
                                                orderDetails.Order_id.Shipping_address.Address_line_1%>
                  </p>

                  <p>
                    <%= orderDetails.Order_id.Shipping_address.Address_line_2 %>,<%=
                                                orderDetails.Order_id.Shipping_address.Postal_code %>
                  </p>

                  <p>
                    <%= orderDetails.Order_id.Shipping_address.State %>,<%=
                                                orderDetails.Order_id.Shipping_address.Country %>
                  </p>
                  <p></p>
                </address>
              </div>
            </div>
          </div>


        </div>




        <div id="passwordCriteria" class="mt-2"></div>
        <div class="alert alert-success" id="userSuccessMessage" style="display: none;"></div>
      </div>
      </div>

    </section>
  </main>


  <!-- Footer Section Begin -->
  <footer class="footer">
    <div class="container">
      <div class="row">
        <div class="col-lg-3 col-md-6 col-sm-6">
          <div class="footer__about">
            <div class="footer__logo">
              <a href="#"><img src="img/footer-logo.png" alt="" /></a>
            </div>
            <p>
              The customer is at the heart of our unique
              business model, which includes design.
            </p>
            <a href="#"><img src="img/payment.png" alt="" /></a>
          </div>
        </div>
        <div class="col-lg-2 offset-lg-1 col-md-3 col-sm-6">
          <div class="footer__widget">
            <h6>Shopping</h6>
            <ul>
              <li><a href="#">Clothing Store</a></li>
              <li><a href="#">Trending Shoes</a></li>
              <li><a href="#">Accessories</a></li>
              <li><a href="#">Sale</a></li>
            </ul>
          </div>
        </div>
        <div class="col-lg-2 col-md-3 col-sm-6">
          <div class="footer__widget">
            <h6>Shopping</h6>
            <ul>
              <li><a href="#">Contact Us</a></li>
              <li><a href="#">Payment Methods</a></li>
              <li><a href="#">Delivary</a></li>
              <li><a href="#">Return & Exchanges</a></li>
            </ul>
          </div>
        </div>
        <div class="col-lg-3 offset-lg-1 col-md-6 col-sm-6">
          <div class="footer__widget">
            <h6>NewLetter</h6>
            <div class="footer__newslatter">
              <p>
                Be the first to know about new arrivals,
                look books, sales & promos!
              </p>
              <form action="#">
                <input type="text" placeholder="Your email" />
                <button type="submit">
                  <span class="icon_mail_alt"></span>
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-lg-12 text-center">
          <div class="footer__copyright__text">
            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
            <p>
              Copyright ©
              <script>
                document.write(new Date().getFullYear())
              </script>
              2020 All rights reserved | This template is
              made with
              <i class="fa fa-heart-o" aria-hidden="true"></i>
              by
              <a href="https://colorlib.com" target="_blank">Colorlib</a>
            </p>
            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
          </div>
        </div>
      </div>
    </div>
  </footer>
  <!-- Footer Section End -->

  <!-- Search Begin -->
  <div class="search-model">
    <div class="h-100 d-flex align-items-center justify-content-center">
      <div class="search-close-switch">+</div>
      <form class="search-model-form">
        <input type="text" id="search-input" placeholder="Search here." />
      </form>
    </div>
  </div>
  <!-- Search End -->
  </div>
  <!-- Js Plugins -->
  <script src="/js/jquery-3.3.1.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/jquery.nice-select.min.js"></script>
  <script src="/js/jquery.nicescroll.min.js"></script>
  <script src="/js/jquery.magnific-popup.min.js"></script>
  <script src="/js/jquery.countdown.min.js"></script>
  <script src="/js/jquery.slicknav.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.2/html2canvas.min.js"></script>

  <script src="/js/mixitup.min.js"></script>
  <script src="/js/owl.carousel.min.js"></script>
  <script src="/js/main.js"></script>
  <script>
    document.getElementById('downloadPdf').addEventListener('click', function() {
      var {
        jsPDF
      } = window.jspdf;

      html2canvas(document.getElementById('invoiceContent'), {
        scale: 2 // Increase the scale for better resolution
      }).then(canvas => {
        var imgData = canvas.toDataURL('image/png');
        var pdf = new jsPDF('p', 'mm', 'a4'); // Use 'p' for portrait orientation, 'mm' for millimeters, and 'a4' size

        // Calculate the dimensions of the PDF
        var pdfWidth = pdf.internal.pageSize.getWidth();
        var pdfHeight = pdf.internal.pageSize.getHeight();
        var imgWidth = 210; // A4 size width in mm
        var imgHeight = canvas.height * imgWidth / canvas.width; // Calculate the image height based on the aspect ratio

        // Add the image to the PDF
        pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);

        // Save the PDF
        pdf.save('invoice.pdf');
      });
    });
  </script>

  <script>
    // Add event listener to buttons
    document.querySelectorAll('[data-toggle="modal"][data-target="#exampleModalCenterItem"]').forEach(function(button) {
      button.addEventListener('click', function() {
        var productId = this.getAttribute('data-id');

        var orderId = this.getAttribute('data-order-id');
        var confirmBtn = document.getElementById('confirmCancelBtn');
        confirmBtn.href = '/user/orders/delete-item/' + productId + '?orderId=' + orderId;
      });
    });
  </script>



  <script>
    var linkContainer = document.getElementById("linkContainer")
    if (linkContainer) {
      linkContainer.addEventListener("click", function(e) {
        // Please sync "Home Page/Login" to the project
      })
    }

    var allProductsText = document.getElementById("allProductsText")
    if (allProductsText) {
      allProductsText.addEventListener("click", function(e) {
        // Please sync "All Products" to the project
      })
    }

    var clothingText = document.getElementById("clothingText")
    if (clothingText) {
      clothingText.addEventListener("click", function(e) {
        // Please sync "Clothing" to the project
      })
    }

    var shoesText = document.getElementById("shoesText")
    if (shoesText) {
      shoesText.addEventListener("click", function(e) {
        // Please sync "Shoes" to the project
      })
    }

    var accessoriesText1 = document.getElementById("accessoriesText1")
    if (accessoriesText1) {
      accessoriesText1.addEventListener("click", function(e) {
        // Please sync "Accessories" to the project
      })
    }

    var linkContainer = document.getElementById("linkContainer")
    if (linkContainer) {
      linkContainer.addEventListener("click", function(e) {
        // Please sync "Search" to the project
      })
    }

    var linkContainer1 = document.getElementById("linkContainer1")
    if (linkContainer1) {
      linkContainer1.addEventListener("click", function(e) {
        // Please sync "WishList" to the project
      })
    }

    var linkContainer = document.getElementById("linkContainer")
    if (linkContainer) {
      linkContainer.addEventListener("click", function(e) {
        // Please sync "Mini Cart" to the project
      })
    }

    var linkContainer = document.getElementById("linkContainer")
    if (linkContainer) {
      linkContainer.addEventListener("click", function() {
        window.open(
          "https://themewagon.github.io/malefashion/index.html"
        )
      })
    }

    var myPaymentOptions = document.getElementById("myPaymentOptions")
    if (myPaymentOptions) {
      myPaymentOptions.addEventListener("click", function(e) {
        // Please sync "Digital Wallet" to the project
      })
    }

    var viewAllProducts2 = document.getElementById("viewAllProducts2")
    if (viewAllProducts2) {
      viewAllProducts2.addEventListener("click", function(e) {
        window.location.href = "./addnewaddress"
      })
    }

    var linkContainer = document.getElementById("linkContainer")
    if (linkContainer) {
      linkContainer.addEventListener("click", function() {
        window.open(
          "https://themewagon.github.io/malefashion/shopping-cart.html"
        )
      })
    }
  </script>
  <script>
    function handleDelete(addressId) {
      fetch(`/user/deleteaddres?id=${addressId}`, {
          method: 'PUT',
        }).then(response => response.json())
        .then(data => {
          if (data.message === 'Address deleted successfully') {
            window.location.href = "/user/address"; // Redirect to the address page
          } else {
            alert('Failed to delete address');
          }
        })
        .catch(error => {
          console.error('Error:', error);
        });


    }
  </script>




<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('payment-form');

    form.addEventListener('submit', function (event) {
      event.preventDefault(); // Prevent form submission

      const formData = new FormData(form);

      fetch('/payment-retry', {
        method: 'POST',
        body: formData,
      })
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json();
        })
        .then(data => {
          console.log('Form submission successful', data);
          if (data.message === "Order placed successfully") {
            window.location.href = `user/orders`;
          } else if (data.razorDetails) {
            var options = {
              "key": "rzp_test_oD4HudkUX2nicH",
              "amount": data.razorDetails.amount,
              "currency": "INR",
              "name": "Male Fashion",
              "description": "Test Transaction",
              "image": "img/logo.png",
              "order_id": data.razorDetails.id,
              "handler": function (response) {
                // Call verifyPayment function on successful payment
                verifyPayment(response, data.razorDetails);
              },
              "prefill": {
                "name": "Gaurav Kumar",
                "email": "gaurav.kumar@example.com",
                "contact": "9000090000"
              },
              "notes": {
                "address": "Razorpay Corporate Office"
              },
              "theme": {
                "color": "#3399cc"
              },
              "modal": {
                "ondismiss": function () {
                  console.log(data.razorDetails);
                  window.location.href = `payment-failed?receipt=${data.razorDetails.receipt}`;
                }
              }
            };
            var rzp1 = new Razorpay(options);
            rzp1.open();
          } else {
            console.log('Order placement failed or invalid response');
          }
        })
        .catch(error => {
          console.error('Error during form submission', error);
        });
    });

    // Function to verify payment with the server
    function verifyPayment(payment, order) {
      fetch('/verify-payment', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          payment,
          order
        })
      })
        .then(response => response.json())
        .then(data => {
          if (data.message === "Order placed successfully") {
            window.location.href = '/user/orders';
          } else {
            alert(data.message);
          }
        })
        .catch(error => {
          alert("Payment verification failed");
          console.error('Error during payment verification', error);
        });
    }
  });
</script>


</body>

</html>